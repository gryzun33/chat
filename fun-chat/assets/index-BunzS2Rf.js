var M=Object.defineProperty;var E=(l,t,e)=>t in l?M(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var i=(l,t,e)=>(E(l,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();class x{constructor(){i(this,"listeners",{})}on(t,e){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),()=>{this.off(t,e)}}off(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(s=>s!==e))}emit(t,...e){const s=this.listeners[t];s&&s.forEach(a=>{a(...e)})}}const o=new x;class n{constructor(t){i(this,"element");i(this,"children",[]);i(this,"handlers",[]);i(this,"emitterMap",new Map);i(this,"unsubscribes",[]);i(this,"destroy",()=>{this.destroyChildren(),this.element.remove(),this.deleteHandlers(),this.unsubscribeEmitter()});this.element=document.createElement(t.tag||"div"),this.addClasses(t.classNames),t.text!==null&&this.setTextContent(t.text)}addUnsubscribers(){this.emitterMap.forEach((t,e)=>{this.unsubscribes.push(o.on(e,t))})}getElement(){return this.element}getChildren(){return this.children}addClasses(t=[]){t.map(e=>this.element.classList.add(e))}setTextContent(t=""){this.element.textContent=t}getTextContent(){return this.element.textContent}addClass(t){this.element.classList.add(t)}toggleClass(t){this.element.classList.toggle(t)}removeClass(t){this.element.classList.remove(t)}append(...t){t.forEach(e=>{e instanceof n&&(this.element.append(e.element),this.children.push(e))})}insertBefore(t,e,s){this.element.insertBefore(t.element,e.element),this.children[s]=t}attr(t,e){return e&&this.element.setAttribute(t,e),this.element.getAttribute(t)}removeAttr(t){this.element.removeAttribute(t)}css(t,e){this.element.style.setProperty(t,e)}findAll(t){return[...this.element.querySelectorAll(t)]}closest(t){return this.element.closest(t)}on(t,e){this.element.addEventListener(t,e),this.handlers.push({eventType:t,callback:e})}off(t,e){this.element.removeEventListener(t,e)}html(t){this.element.innerHTML=t}destroyChildren(){this.children.length>0&&(this.children.forEach(t=>{t.destroy()}),this.children.length=0)}unsubscribeEmitter(){this.unsubscribes.forEach(t=>{t()})}deleteHandlers(){this.handlers.forEach(t=>{this.off(t.eventType,t.callback)})}}class b{constructor(t){i(this,"keys",new Set);this.keyPrefix=t}getStorageKey(t){const e=`${this.keyPrefix}_${t}`;return this.keys.add(e),e}saveData(t,e){const s=this.getStorageKey(t.toString());sessionStorage.setItem(s,JSON.stringify(e))}getData(t){const e=this.getStorageKey(t.toString()),s=sessionStorage.getItem(e);return s?JSON.parse(s):null}removeStorage(){this.keys.forEach(t=>{sessionStorage.removeItem(t)})}}const p=new b("gryzun33-chat");class C{constructor(t){i(this,"routes");i(this,"navigate",t=>{if(typeof t!="string")throw new Error("url isn`t string");let e=t;const s=p.getData("user");e==="back"&&(e=s?"main":"login"),e.length>0&&window.history.pushState(null,"",`/${e}`);const a=this.routes.find(r=>r.path===e);a?a.callback():this.navigate(this.routes[0].path)});i(this,"handleRouteChange",()=>{const t=window.location.pathname.slice(1);this.navigate(t)});this.routes=t,o.on("navigate",this.navigate),window.addEventListener("popstate",this.handleRouteChange)}init(){document.addEventListener("DOMContentLoaded",()=>{let t=window.location.pathname.slice(1);p.getData("user")||(t==="main"&&(t="login"),this.navigate(t))})}}class U{constructor(t,e){i(this,"ws");i(this,"reconnectInterval",1e3);i(this,"isConnect",!0);i(this,"connect",()=>{this.ws=new WebSocket("ws://localhost:4000"),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("close",this.onClose),this.ws.addEventListener("error",this.onError)});i(this,"onOpen",()=>{this.isConnect=!0,o.emit("connect"),this.checkAuthorized()});i(this,"onClose",()=>{this.isConnect&&(this.isConnect=!1,o.emit("disconnect")),setTimeout(()=>{this.connect()},this.reconnectInterval)});i(this,"onMessage",t=>{const{data:e}=t;this.dataHandler(e)});i(this,"onError",t=>{var e;console.error("WebSocket error:",t),(e=this.ws)==null||e.close()});this.dataHandler=t,this.checkAuthorized=e,this.connect()}send(t){var e;(e=this.ws)==null||e.send(t)}}var h=(l=>(l.Sent="sent",l.Delivered="delivered",l.Readed="readed",l.Edited="edited",l))(h||{});function w(l){const t=new Date(l),e=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear(),r=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0"),u=String(t.getSeconds()).padStart(2,"0");return`${e}.${s}.${a}, ${r}:${c}:${u}`}function N(l){return typeof l=="object"&&typeof l.id=="string"&&typeof l.text=="string"&&typeof l.status=="string"&&typeof l.date=="string"&&typeof l.author=="boolean"&&typeof l.dialogUser=="string"}class k{constructor(){i(this,"usersMap",new Map);i(this,"messagesMap",new Map);i(this,"currUser",{id:"",login:"",password:""});i(this,"dialogUser",{login:"",isLogined:!0});i(this,"dialogId","");i(this,"editedMsg",{id:"",text:""});const t=p.getData("user");t&&(this.currUser.login=t.login,this.currUser.password=t.password)}updateState(){this.usersMap.clear(),this.messagesMap.clear(),this.dialogUser={login:"",isLogined:!0}}saveUser(t){this.currUser={...t}}getUser(){return this.currUser}setEditedMsg(t,e){this.editedMsg={id:t,text:e}}getEditedMsg(){return this.editedMsg}changeUserStatus(t){const e=this.usersMap.get(t.login);e?e.isLogined=t.isLogined:this.usersMap.set(t.login,{notifications:0,isLogined:t.isLogined}),t.login===this.dialogUser.login&&o.emit("change-status",t.isLogined)}setNotifications(t,e){const s=this.usersMap.get(t);if(!s)throw new Error("user is undefined");s.notifications=e,s.isLogined?o.emit("external-login",t,s.notifications):o.emit("external-logout",t,s.notifications)}setDialogUser(t){const e=this.usersMap.get(t);if(e===void 0)throw new Error("status is undefined");const{isLogined:s}=e;this.dialogUser={login:t,isLogined:s}}getDialogUser(){return this.dialogUser}addMessage(t){this.messagesMap.set(t.id,t);const e=t.from===this.currUser.login,s=t.from,a=w(t.datetime),r=t.status.isDelivered?h.Delivered:h.Sent,c={id:t.id,author:e,dialogUser:s,date:a,status:r,text:t.text,isEdited:!1};e||d.addNotification(t.from),!(!e&&t.from!==this.dialogUser.login)&&o.emit("add-message",c)}addMessages(t){this.messagesMap.clear(),t.forEach(s=>{this.messagesMap.set(s.id,s)});const e=t.map(s=>{const a=s.from===this.currUser.login,r=s.from,c=w(s.datetime),u=this.getStatus(s.status),{isEdited:S}=s.status;return{id:s.id,author:a,dialogUser:r,date:c,status:u,text:s.text,isEdited:S}});o.emit("add-messages",e)}getStatus(t){let e="";return e=t.isDelivered?h.Delivered:h.Sent,e=t.isReaded?h.Readed:e,e}addNotification(t){const e=this.usersMap.get(t);if(!e)throw new Error("user is undefined");e.notifications+=1,o.emit("update-notifications",t,e.notifications)}resetNotifications(){const t=this.usersMap.get(this.dialogUser.login);if(!t)throw new Error("user is undefined");t.notifications=0,o.emit("update-notifications",this.dialogUser.login,t.notifications)}}const d=new k,f={login:"a user with this login is already authorized",password:"incorrect password"};class R{onError(t){switch(t){case f.login:o.emit("incorrectAuth",f.login);break;case f.password:o.emit("incorrectAuth",f.password);break;default:console.error("unknown error type");break}}}class D{constructor(){i(this,"errorHandler",new R);i(this,"getData",t=>{const e=JSON.parse(t);switch(e.type){case"USER_LOGIN":this.authorize(e.payload.user,e.id);break;case"USER_LOGOUT":this.logoutResponse(e.payload.user);break;case"USER_EXTERNAL_LOGIN":this.userStatusResponse(e.payload.user);break;case"USER_EXTERNAL_LOGOUT":this.userStatusResponse(e.payload.user);break;case"USER_ACTIVE":this.usersResponse(e.payload.users);break;case"USER_INACTIVE":this.usersResponse(e.payload.users);break;case"MSG_SEND":this.messageResponse(e.payload.message);break;case"MSG_FROM_USER":this.messagesResponse(e.payload.messages,e.id);break;case"MSG_DELIVER":this.deliverResponse(e.payload.message);break;case"MSG_READ":this.readResponse(e.payload.message);break;case"MSG_EDIT":this.editResponse(e.payload.message);break;case"MSG_DELETE":this.deleteResponse(e.payload.message);break;case"ERROR":this.errorHandler.onError(e.payload.error);break;default:console.error("unknown type");break}});i(this,"messageResponse",t=>{d.addMessage(t)});i(this,"messagesResponse",(t,e)=>{if(e===d.dialogId){d.addMessages(t);return}const{login:s}=d.getUser(),r=t.filter(c=>c.from!==s&&!c.status.isReaded).length;d.setNotifications(e,r)})}authorize(t,e){if(t.isLogined){const{id:s,login:a,password:r}=d.getUser();if(e===s){p.saveData("user",{login:a,password:r});let c=window.location.pathname.slice(1);c=c==="about"?"about":"main",o.emit("navigate",c)}}}logoutResponse(t){t.isLogined||(p.removeStorage(),o.emit("navigate","login"))}usersResponse(t){const{login:e}=d.getUser();t.forEach(s=>{s.login!==e&&(o.emit("get-notifications",s.login),d.changeUserStatus(s))})}userStatusResponse(t){o.emit("get-notifications",t.login),d.changeUserStatus(t)}deliverResponse(t){const e=d.messagesMap.get(t.id);if(!e)throw new Error("message is undefined");e.status.isDelivered=!0,o.emit("delivered",t.id)}readResponse(t){const e=d.messagesMap.get(t.id),{login:s}=d.getDialogUser();e&&(e.status.isReaded=!0,s!==e.from&&o.emit("readed",t.id))}editResponse(t){const e=d.messagesMap.get(t.id);if(!e)throw new Error("message is undefined");e.status.isEdited=!0,e.text=t.text,o.emit("edited",t.id,t.text)}deleteResponse(t){d.messagesMap.delete(t.id),o.emit("deleted",t.id)}}const g={login:"USER_LOGIN",logout:"USER_LOGOUT",activeUsers:"USER_ACTIVE",inactiveUsers:"USER_INACTIVE",msgFromUser:"MSG_FROM_USER",messSend:"MSG_SEND",messRead:"MSG_READ",messEdit:"MSG_EDIT",messDelete:"MSG_DELETE"};class I{constructor(){i(this,"dataHandler",new D);i(this,"wsManager");i(this,"checkAuthorized",()=>{d.updateState();const t=p.getData("user");if(t){const{login:e,password:s}=t;this.loginRequest(e,s)}});i(this,"loginRequest",(t,e)=>{var r;if(typeof t!="string"||typeof e!="string")throw new Error("login or password is not string");const s=crypto.randomUUID();d.saveUser({id:s,login:t,password:e});const a={id:s,type:g.login,payload:{user:{login:t,password:e}}};(r=this.wsManager)==null||r.send(JSON.stringify(a)),this.externalUsersRequest()});i(this,"logoutRequest",()=>{var r;const{login:t,password:e}=d.getUser(),a={id:crypto.randomUUID(),type:g.logout,payload:{user:{login:t,password:e}}};(r=this.wsManager)==null||r.send(JSON.stringify(a))});i(this,"dialogUserRequset",t=>{if(typeof t!="string")throw new Error("login isnt't string");d.setDialogUser(t),this.notificationsDialogRequest(t)});i(this,"notificationsDialogRequest",t=>{var a;const e=crypto.randomUUID();d.dialogId=e;const s={id:d.dialogId,type:g.msgFromUser,payload:{user:{login:t}}};(a=this.wsManager)==null||a.send(JSON.stringify(s))});i(this,"notificationsRequest",t=>{var s;if(typeof t!="string")throw new Error("login isnt't string");const e={id:t,type:"MSG_FROM_USER",payload:{user:{login:t}}};(s=this.wsManager)==null||s.send(JSON.stringify(e))});i(this,"sendRequest",t=>{var a;if(typeof t!="string")throw new Error("login isnt't string");const e=d.getDialogUser(),s={id:null,type:g.messSend,payload:{message:{to:e.login,text:t}}};(a=this.wsManager)==null||a.send(JSON.stringify(s))});i(this,"readedRequest",()=>{Array.from(d.messagesMap.values()).filter(s=>!s.status.isReaded).map(s=>s.id).forEach(s=>{var r;const a={id:"",type:g.messRead,payload:{message:{id:s}}};(r=this.wsManager)==null||r.send(JSON.stringify(a))}),d.resetNotifications()});i(this,"editRequest",t=>{var a;if(typeof t!="string")throw new Error("text is not string");const{id:e}=d.getEditedMsg(),s={id:"",type:g.messEdit,payload:{message:{id:e,text:t}}};(a=this.wsManager)==null||a.send(JSON.stringify(s))});i(this,"deleteRequest",t=>{var s;if(typeof t!="string")throw new Error("id is not string");const e={id:"",type:g.messDelete,payload:{message:{id:t}}};(s=this.wsManager)==null||s.send(JSON.stringify(e))});this.wsManager=new U(this.dataHandler.getData,this.checkAuthorized),o.on("login",this.loginRequest),o.on("logout",this.logoutRequest),o.on("send-message",this.sendRequest),o.on("set-dialog-user",this.dialogUserRequset),o.on("get-notifications",this.notificationsRequest),o.on("set-readed",this.readedRequest),o.on("edit-message",this.editRequest),o.on("delete-message",this.deleteRequest)}externalUsersRequest(){var s,a;const t=this.getUsers(g.activeUsers),e=this.getUsers(g.inactiveUsers);(s=this.wsManager)==null||s.send(JSON.stringify(t)),(a=this.wsManager)==null||a.send(JSON.stringify(e))}getUsers(t){return{id:crypto.randomUUID(),type:t,payload:null}}}class m extends n{constructor(e){super({tag:"button",...e});i(this,"enableState",!0);i(this,"disable",()=>{this.element.disabled=!0});i(this,"enable",()=>{this.element.disabled=!1});e.type&&this.attr("type",e.type),e.callback&&this.on("click",e.callback),e.disabled&&this.disable()}}class v extends n{constructor(e){super({tag:"div",classNames:["input-wrapper"]});i(this,"input",new n({tag:"input",classNames:["input"]}));i(this,"toolTip",new n({tag:"div",classNames:["tooltip"]}));i(this,"onInput",()=>{this.input.element.validity.valid?(this.toolTip.removeClass("visible"),this.input.removeClass("incorrect")):(this.toolTip.addClass("visible"),this.input.addClass("incorrect"))});this.createView(e),this.input.on("input",this.onInput)}createView(e){const s=new n({tag:"label",classNames:["label"],text:e.label}),a=new n({tag:"div",classNames:["input-box"]});this.input.attr("minlength",e.minlength),this.input.attr("pattern",e.pattern),this.input.attr("type",e.type),e.required&&(this.input.element.required=!0),e.autocomplete&&this.input.attr("autocomplete","off"),this.toolTip.setTextContent(e.toolTip),a.append(this.input,this.toolTip),this.append(s,a)}}class y extends n{constructor(e){super({tag:"div",classNames:["modal-wrapper"]});i(this,"modalContent",new n({tag:"div",classNames:["modal-content"]}));i(this,"modalText",new n({tag:"p",classNames:["modal-text"]}));i(this,"open",e=>{this.addClass("overlay-show"),this.modalContent.addClass("modal-show"),this.setContent(e)});i(this,"close",()=>{this.addClass("overlay-hide"),this.modalContent.addClass("modal-hide"),this.on("animationend",()=>{this.destroy()})});this.open(e)}createView(){this.append(this.modalContent)}setContent(e){const s=e[0].toUpperCase()+e.slice(1);this.modalText.setTextContent(s)}}class _ extends y{constructor(e){super(e);i(this,"okBtn",new m({classNames:["ok-btn"],text:"Ok"}));this.okBtn.on("click",this.close),this.createView()}createView(){super.createView(),this.modalContent.append(this.modalText,this.okBtn)}}class L extends n{constructor(){super({tag:"div",classNames:["login-wrapper"]});i(this,"modal");i(this,"inputs",[]);i(this,"loginForm",new n({tag:"form",classNames:["login-form"]}));i(this,"inputLogin",new v({type:"text",required:!0,minlength:"3",pattern:"^[a-zA-Z0-9]{3,}$",toolTip:"Login must be at least three characters long, and can contain letters and numbers",label:"Login"}));i(this,"inputPassword",new v({type:"password",required:!0,minlength:"8",pattern:"^(?=.*[a-zA-Z])(?=.*\\d).{5,}$",toolTip:"Password must be at least 8 characters long, and contain at least one letter and one digit",label:"Password",autocomplete:"off"}));i(this,"loginBtn",new m({type:"submit",classNames:["login-btn"],text:"Login"}));i(this,"infoBtn",new n({tag:"a",classNames:["info-btn"]}));i(this,"onChangeForm",()=>{this.inputs.every(e=>e.validity.valid&&e.value!=="")?this.loginBtn.enable():this.loginBtn.disable()});i(this,"onSubmitForm",e=>{const s=this.inputLogin.input.element.value,a=this.inputPassword.input.element.value;o.emit("login",s,a),e.preventDefault()});i(this,"openModal",e=>{if(typeof e!="string")throw new Error("modaltext isn`t string");this.modal=new _(e),this.append(this.modal)});this.createView(),this.loginForm.on("input",this.onChangeForm),this.loginForm.on("submit",this.onSubmitForm),this.infoBtn.on("click",()=>o.emit("navigate","about")),o.on("incorrectAuth",this.openModal)}createView(){const e=new n({tag:"div",classNames:["buttons-box"]});e.append(this.loginBtn,this.infoBtn),this.loginForm.append(this.inputLogin,this.inputPassword,e),this.append(this.loginForm),this.loginForm.attr("novalidate","true"),this.loginBtn.disable(),this.inputs.push(this.inputLogin.input.getElement(),this.inputPassword.input.getElement())}}const V=`<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10" stroke-width="1.5"/>
<path d="M12 17V11" stroke="#356b79" stroke-width="1.5" stroke-linecap="round"/>
<circle cx="1" cy="1" r="1" transform="matrix(1 0 0 -1 11 9)" fill="#356b79"/>
</svg>`,B=`<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M21 12L13 12" stroke="#254e58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M18 15L20.913 12.087V12.087C20.961 12.039 20.961 11.961 20.913 11.913V11.913L18 9" stroke="#254e58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M16 5V4.5V4.5C16 3.67157 15.3284 3 14.5 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H14.5C15.3284 21 16 20.3284 16 19.5V19.5V19" stroke="#254e58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,T='<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50"><path d="M17.791,46.836C18.502,46.53,19,45.823,19,45v-5.4c0-0.197,0.016-0.402,0.041-0.61C19.027,38.994,19.014,38.997,19,39 c0,0-3,0-3.6,0c-1.5,0-2.8-0.6-3.4-1.8c-0.7-1.3-1-3.5-2.8-4.7C8.9,32.3,9.1,32,9.7,32c0.6,0.1,1.9,0.9,2.7,2c0.9,1.1,1.8,2,3.4,2 c2.487,0,3.82-0.125,4.622-0.555C21.356,34.056,22.649,33,24,33v-0.025c-5.668-0.182-9.289-2.066-10.975-4.975 c-3.665,0.042-6.856,0.405-8.677,0.707c-0.058-0.327-0.108-0.656-0.151-0.987c1.797-0.296,4.843-0.647,8.345-0.714 c-0.112-0.276-0.209-0.559-0.291-0.849c-3.511-0.178-6.541-0.039-8.187,0.097c-0.02-0.332-0.047-0.663-0.051-0.999 c1.649-0.135,4.597-0.27,8.018-0.111c-0.079-0.5-0.13-1.011-0.13-1.543c0-1.7,0.6-3.5,1.7-5c-0.5-1.7-1.2-5.3,0.2-6.6 c2.7,0,4.6,1.3,5.5,2.1C21,13.4,22.9,13,25,13s4,0.4,5.6,1.1c0.9-0.8,2.8-2.1,5.5-2.1c1.5,1.4,0.7,5,0.2,6.6c1.1,1.5,1.7,3.2,1.6,5 c0,0.484-0.045,0.951-0.11,1.409c3.499-0.172,6.527-0.034,8.204,0.102c-0.002,0.337-0.033,0.666-0.051,0.999 c-1.671-0.138-4.775-0.28-8.359-0.089c-0.089,0.336-0.197,0.663-0.325,0.98c3.546,0.046,6.665,0.389,8.548,0.689 c-0.043,0.332-0.093,0.661-0.151,0.987c-1.912-0.306-5.171-0.664-8.879-0.682C35.112,30.873,31.557,32.75,26,32.969V33 c2.6,0,5,3.9,5,6.6V45c0,0.823,0.498,1.53,1.209,1.836C41.37,43.804,48,35.164,48,25C48,12.318,37.683,2,25,2S2,12.318,2,25 C2,35.164,8.63,43.804,17.791,46.836z"/></svg>',q='<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 552.8 205.3"><style>.st0{fill:#fff}.st1{clip-path:url(#SVGID_2_)}.st2{clip-path:url(#SVGID_4_)}.st3{clip-path:url(#SVGID_6_)}.st4{clip-path:url(#SVGID_8_)}.st5{fill:#fff;stroke:#000;stroke-width:4;stroke-miterlimit:10}.st6{clip-path:url(#SVGID_8_)}.st6,.st7{fill:none;stroke:#000;stroke-width:4;stroke-miterlimit:10}.st8,.st9{clip-path:url(#SVGID_10_)}.st9{fill:none;stroke:#000;stroke-width:4;stroke-miterlimit:10}</style><title>rs_school_js</title><path d="M285.4 68l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.9 3.6 6.9 5.4 12.2 5.4 3.9 0 7-.9 9.1-2.8 2-1.5 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.1-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4 6 4.2 9.6 11 10.7 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8s-5.3-2.8-9.2-2.8c-3.2 0-5.6.7-7.2 2-1.5 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.5 13.3 0 5.6-1.6 11.2-4.8 15.9-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8S286.1 77 285.4 68zM6.3 97.6V8.2h46.1c8.5 0 15.1.7 19.6 2.2 4.4 1.4 8.3 4.3 10.9 8.2 2.9 4.3 4.3 9.3 4.2 14.5.3 8.8-4.2 17.2-11.9 21.6-3 1.7-6.3 2.9-9.7 3.5 2.5.7 5 1.9 7.2 3.3 1.7 1.4 3.1 3 4.4 4.7 1.5 1.7 2.8 3.6 3.9 5.6l13.4 25.9H63L48.2 70.2c-1.9-3.5-3.5-5.8-5-6.9-2-1.4-4.4-2.1-6.8-2.1H34v36.3H6.3zM34 44.4h11.7c2.5-.2 4.9-.6 7.3-1.2 1.8-.3 3.4-1.3 4.5-2.8 2.7-3.6 2.3-8.7-1-11.8-1.8-1.5-5.3-2.3-10.3-2.3H34v18.1zM0 174.2l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.8 3.6 6.9 5.5 12.2 5.5 3.9 0 7-.9 9.1-2.8 2-1.6 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.2-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4s9.5 11 10.6 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8-2.2-1.9-5.3-2.8-9.2-2.7-3.2 0-5.6.7-7.2 2.1-1.6 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.6 13.2 0 5.6-1.7 11.1-4.8 15.8-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8-5.9-6-9.2-13.4-10-22.4z"/><path d="M133 167.2l24.2 7.3c-1.3 6.1-4 11.9-7.7 17-3.4 4.5-7.9 8-13 10.3-5.2 2.3-11.8 3.5-19.8 3.5-9.7 0-17.7-1.4-23.8-4.2-6.2-2.8-11.5-7.8-16-14.9-4.5-7.1-6.7-16.2-6.7-27.3 0-14.8 3.9-26.2 11.8-34.1s19-11.9 33.4-11.9c11.3 0 20.1 2.3 26.6 6.8 6.4 4.6 11.2 11.6 14.4 21l-24.4 5.4c-.6-2.1-1.5-4.2-2.7-6-1.5-2.1-3.4-3.7-5.7-4.9-2.3-1.2-4.9-1.7-7.5-1.7-6.3 0-11.1 2.5-14.4 7.6-2.5 3.7-3.8 9.6-3.8 17.6 0 9.9 1.5 16.7 4.5 20.4 3 3.7 7.2 5.5 12.7 5.5 5.3 0 9.3-1.5 12-4.4 2.7-3.1 4.7-7.4 5.9-13zm56.5-52.8h27.6v31.3h30.2v-31.3h27.8v89.4h-27.8v-36.2h-30.2v36.2h-27.6v-89.4z"/><path d="M271.3 159.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.3 4 34.4 12S364 144 364 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8s4.9-10.8 4.9-20.8c0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5zm93.4-.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.4 4 34.4 12S485 144 485 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8 3.3-3.9 4.9-10.8 4.9-20.8 0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10.1 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5z"/><path d="M482.1 114.4h27.6v67.4h43.1v22H482v-89.4z"/><ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_1_" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><g class="st1"><path transform="rotate(-37.001 420.82 68.353)" class="st0" d="M330.9-14.2h179.8v165.1H330.9z"/><g id="Layer_2_1_"><defs><path id="SVGID_3_" transform="rotate(-37.001 420.82 68.353)" d="M330.9-14.2h179.8v165.1H330.9z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" overflow="visible"/></clipPath><g id="Layer_1-2" class="st2"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_5_" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" overflow="visible"/></clipPath><g class="st3"><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_7_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" overflow="visible"/></clipPath><g class="st4"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st6" d="M357.8 17h125.9v103.7H357.8z"/><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_9_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" overflow="visible"/></clipPath><g class="st8"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st9" d="M357.8 17h125.9v103.7H357.8z"/><path transform="rotate(-37.001 420.82 68.353)" class="st7" d="M330.9-14.2h179.8v165.1H330.9z"/></g><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/><path d="M392.4 61.3l10-7 12.3 17.5c2.1 2.8 3.7 5.8 4.9 9.1.7 2.5.5 5.2-.5 7.6-1.3 3-3.4 5.5-6.2 7.3-3.3 2.3-6.1 3.6-8.5 4-2.3.4-4.7 0-6.9-1-2.4-1.2-4.5-2.9-6.1-5.1l8.6-8c.7 1.1 1.6 2.1 2.6 2.9.7.5 1.5.8 2.4.8.7 0 1.4-.3 1.9-.7 1-.6 1.7-1.8 1.6-3-.3-1.7-1-3.4-2.1-4.7l-14-19.7zm30 11.1l9.1-7.2c1 1.2 2.3 2.1 3.7 2.6 2 .6 4.1.2 5.8-1.1 1.2-.8 2.2-1.9 2.6-3.3.6-1.8-.4-3.8-2.2-4.4-.3-.1-.6-.2-.9-.2-1.2-.1-3.3.4-6.4 1.7-5.1 2.1-9.1 2.9-12.1 2.6-2.9-.3-5.6-1.8-7.2-4.3-1.2-1.7-1.8-3.7-1.9-5.7 0-2.3.6-4.6 1.9-6.5 1.9-2.7 4.2-5 7-6.8 4.2-2.9 7.9-4.3 11.1-4.3 3.2 0 6.2 1.5 9 4.6l-9 7.1c-1.8-2.3-5.2-2.8-7.5-1l-.3.3c-1 .6-1.7 1.5-2.1 2.6-.3.8-.1 1.7.4 2.4.4.5 1 .9 1.7.9.8.1 2.2-.3 4.2-1.2 5-2.1 8.8-3.3 11.4-3.7 2.2-.4 4.5-.2 6.6.7 1.9.8 3.5 2.2 4.6 3.9 1.4 2 2.2 4.4 2.3 6.9.1 2.6-.6 5.1-2 7.3-1.8 2.7-4.1 5-6.8 6.8-5.5 3.8-10 5.4-13.6 4.8-3.9-.6-7.1-2.6-9.4-5.5z"/></g></g></g></svg>';class P extends n{constructor(e){super(e);i(this,"currUser",new n({tag:"p",classNames:["curr-user"]}));i(this,"infoBtn",new n({tag:"a",classNames:["main-info-btn"]}));i(this,"logoutBtn",new n({tag:"a",classNames:["logout-btn"]}));i(this,"onClickInfoBtn",()=>{o.emit("navigate","about"),d.updateState()});this.createView(),this.logoutBtn.on("click",()=>o.emit("logout")),this.infoBtn.on("click",this.onClickInfoBtn)}createView(){const e=new n({tag:"div",classNames:["buttons"]});this.infoBtn.html(V),this.logoutBtn.html(B),e.append(this.infoBtn,this.logoutBtn);const s=new n({tag:"h1",classNames:["header-title"],text:"Fun Chat"});this.append(this.currUser,s,e);const{login:a}=d.getUser();this.currUser.html(`<span>${a}</span>`)}}class G extends n{constructor(t){super(t),this.createView()}createView(){const t=new n({tag:"a",classNames:["icon-github"]});t.attr("href","https://github.com/gryzun33"),t.attr("target","_blank"),t.html(T);const e=new n({tag:"p",classNames:["year"]});e.html("&copy;2024");const s=new n({tag:"a",classNames:["icon-school"]});s.attr("href","https://rs.school/"),s.attr("target","_blank"),s.html(q),this.append(t,e,s)}}class O extends n{constructor(e){super(e);i(this,"usersMap",new Map);i(this,"userSearch",new n({tag:"input",classNames:["user-search"]}));i(this,"activeList",new n({tag:"ul",classNames:["active-list"]}));i(this,"inactiveList",new n({tag:"ul",classNames:["inactive-list"]}));i(this,"userList",new n({tag:"div",classNames:["users-list"]}));i(this,"addActiveUser",(e,s)=>{if(typeof e!="string"||typeof s!="number")throw new Error("arguments don't match their types");let a=this.usersMap.get(e);a||(a=this.getNewUserItem(e,s)),a.addClass("active-user"),this.activeList.append(a)});i(this,"addInactiveUser",(e,s)=>{if(typeof e!="string"||typeof s!="number")throw new Error("arguments don't match their types");let a=this.usersMap.get(e);a||(a=this.getNewUserItem(e,s)),a.removeClass("active-user"),this.inactiveList.append(a)});i(this,"onClickUsers",e=>{const{target:s}=e;if(!(s instanceof HTMLElement))throw new Error("target isn't HTMLEelement");const a=s.closest(".user-item");if(!a)throw new Error("userElement is null");const r=a.getAttribute("data-login");a.closest(".active-list")?o.emit("set-dialog-user",r,!0):a.closest(".inactive-list")&&o.emit("set-dialog-user",r,!1),o.emit("reset-new-message"),this.resetUserList()});i(this,"searchUsers",()=>{const e=this.userSearch.getElement().value.toLowerCase(),s=Array.from(this.usersMap.values());e.trim()===""?s.forEach(a=>a.removeClass("user-hidden")):s.forEach(a=>{const r=a.attr("data-login");if(!r)throw new Error("id is null");r.toLowerCase().includes(e)?a.removeClass("user-hidden"):a.addClass("user-hidden")})});i(this,"resetUserList",()=>{Array.from(this.usersMap.values()).forEach(s=>s.removeClass("user-hidden")),this.userSearch.getElement().value=""});i(this,"updateNotifications",(e,s)=>{if(typeof e!="string"||typeof s!="number")throw new Error("arguments don't match their types");const a=this.usersMap.get(e);if(!a)throw new Error("user is undefined");const r=a.children[1];r.setTextContent(String(s)),s>0?r.removeClass("hidden"):r.addClass("hidden")});this.createView(),this.activeList.on("click",this.onClickUsers),this.inactiveList.on("click",this.onClickUsers),this.userSearch.on("input",this.searchUsers),this.usersMap.clear(),this.emitterMap=new Map([["external-login",this.addActiveUser],["external-logout",this.addInactiveUser],["update-notifications",this.updateNotifications]]),this.addUnsubscribers()}createView(){this.userList.append(this.activeList,this.inactiveList),this.append(this.userSearch,this.userList),this.userSearch.attr("placeholder","Search...")}getNewUserItem(e,s){const a=new n({tag:"li",classNames:["user-item"]}),r=new n({tag:"div",classNames:["user-text"],text:e}),c=new n({tag:"div",classNames:["user-notifications"],text:String(s)});return s===0&&c.addClass("hidden"),a.append(r,c),a.attr("data-login",`${e}`),this.usersMap.set(e,a),a}}class H extends n{constructor(e){super({tag:"div",classNames:["message"]});i(this,"id","");i(this,"text","");i(this,"contextMenu");i(this,"msgText",new n({tag:"p",classNames:["msg-text"]}));i(this,"msgStatus",new n({tag:"p",classNames:["msg-status"]}));i(this,"msgStatusEdited",new n({tag:"p",classNames:["msg-edited"]}));this.id=e.id,this.text=e.text,this.createView(e)}createView(e){this.attr("id",e.id);const s=new n({tag:"div",classNames:["msg-top-info"]}),a=e.author?"you":e.dialogUser,r=new n({tag:"p",classNames:["msg-author"],text:a}),c=new n({tag:"p",classNames:["msg-date"],text:e.date});s.append(r,c),this.msgText.setTextContent(e.text),e.isEdited&&this.msgStatusEdited.setTextContent("edited"),e.author&&this.msgStatus.setTextContent(e.status);const u=new n({tag:"p",classNames:["msg-status-box"]});u.append(this.msgStatusEdited,this.msgStatus),this.append(s,this.msgText,u),e.author?this.addClass("message-right"):this.addClass("message-left")}setStatusDelivered(){this.msgStatus.setTextContent(h.Delivered)}setStatusReaded(){this.msgStatus.setTextContent(h.Readed)}setStatusEdited(e){this.msgStatusEdited.setTextContent(h.Edited),this.msgText.setTextContent(e)}}class z extends n{constructor(e,s){super({tag:"div",classNames:["context-menu"]});i(this,"editBtn",new m({type:"text",classNames:["edit-btn"],text:"Edit"}));i(this,"deleteBtn",new m({type:"text",classNames:["delete-btn"],text:"Delete"}));i(this,"onClickEditBtn",()=>{o.emit("change-message",this.text),d.setEditedMsg(this.id,this.text)});i(this,"onClickDeleteBtn",()=>{o.emit("delete-message",this.id)});this.id=e,this.text=s,this.createView(),this.editBtn.on("click",this.onClickEditBtn),this.deleteBtn.on("click",this.onClickDeleteBtn)}createView(){this.append(this.editBtn,this.deleteBtn)}}class A extends n{constructor(e){super(e);i(this,"messagesMap",new Map);i(this,"isDivider",!1);i(this,"isProgrammScroll",!1);i(this,"dialogStatus","no-dialog-user");i(this,"contextMenu");i(this,"divider",new n({tag:"div",classNames:["divider"],text:"New messages"}));i(this,"dialogUserLogin",new n({tag:"p",classNames:["dialog-user-login"]}));i(this,"dialogUserStatus",new n({tag:"p",classNames:["dialog-user-status"],text:""}));i(this,"messagesBox",new n({tag:"div",classNames:["messages-box"]}));i(this,"messages",new n({tag:"div",classNames:["messages"]}));i(this,"placeholder",new n({tag:"div",classNames:["placeholder"],text:"Select a user to send a message to..."}));i(this,"onScrollEndHandler",()=>{this.isProgrammScroll&&(this.isProgrammScroll=!1)});i(this,"setDialogUser",(e,s)=>{if(typeof e!="string"||typeof s!="boolean")throw new Error("login or status does not match type ");this.dialogUserLogin.setTextContent(e),this.changeStatus(s),this.changePlaceholder(),this.dialogStatus="no-messages"});i(this,"changePlaceholder",()=>{this.placeholder.removeClass("placeholder-hidden"),this.placeholder.setTextContent("Please write your first message...")});i(this,"changeStatus",e=>{if(typeof e!="boolean")throw new Error("status isn't boolean");this.dialogUserStatus.setTextContent(e?"online":"offline"),e?this.dialogUserStatus.removeClass("status-inactive"):this.dialogUserStatus.addClass("status-inactive")});i(this,"addNewMessage",e=>{if(!N(e))throw new Error("type of msg is not MessageProps");this.dialogStatus!=="no-dialog-user"&&(this.dialogStatus==="no-messages"&&this.removePlaceholder(),!e.author&&!this.isDivider&&this.showDivider(),this.addMessage(e),this.scrollMessages(!0))});i(this,"addMessages",e=>{if(!Array.isArray(e))throw new Error("messages is not array");this.destroyMessages(),e.length!==0&&(this.removePlaceholder(),e.forEach(s=>{!s.author&&s.status===h.Delivered&&!this.isDivider&&this.showDivider(),this.addMessage(s)}),this.scrollMessages(!1))});i(this,"showDivider",()=>{this.isDivider=!0,this.messages.append(this.divider),this.divider.removeClass("hidden")});i(this,"removePlaceholder",()=>{this.dialogStatus="messages",this.placeholder.addClass("placeholder-hidden")});i(this,"setStatusDelivered",e=>{if(typeof e!="string")throw new Error("id is not string");const s=this.messagesMap.get(e);if(!s)throw new Error("messageComponent is undefined");s.setStatusDelivered()});i(this,"setStatusReaded",e=>{if(typeof e!="string")throw new Error("id is not string");const s=this.messagesMap.get(e);if(!s)throw new Error("messageComponent is undefined");s.setStatusReaded()});i(this,"setStatusEdited",(e,s)=>{if(typeof e!="string"||typeof s!="string")throw new Error("arguments are not string");const a=this.messagesMap.get(e);if(!a)throw new Error("messageComponent is undefined");a.setStatusEdited(s)});i(this,"deleteMessage",e=>{if(typeof e!="string")throw new Error("id is not string");const s=this.messagesMap.get(e);if(!s)throw new Error("messageComponent is undefined");this.messagesMap.delete(e),s.destroy()});i(this,"destroyMessages",()=>{this.messagesMap.forEach(e=>{e.destroy()}),this.messagesMap.clear(),this.hideDivider()});i(this,"hideDivider",()=>{this.isDivider=!1,this.divider.addClass("hidden")});i(this,"onChangeMessages",()=>{this.isDivider&&(this.hideDivider(),o.emit("set-readed"))});i(this,"onScrollMessages",()=>{this.isProgrammScroll||this.onChangeMessages()});i(this,"createContextMenu",(e,s,a)=>{this.contextMenu&&this.contextMenu.destroy(),this.contextMenu=new z(e,s),a.append(this.contextMenu),this.contextMenu&&document.addEventListener("click",()=>{var r;return(r=this.contextMenu)==null?void 0:r.destroy()},{once:!0})});this.createView(),this.messages.on("click",this.onChangeMessages),this.messages.on("scroll",this.onScrollMessages),this.messages.on("scrollend",this.onScrollEndHandler),this.emitterMap=new Map([["set-dialog-user",this.setDialogUser],["change-status",this.changeStatus],["add-message",this.addNewMessage],["add-messages",this.addMessages],["delivered",this.setStatusDelivered],["readed",this.setStatusReaded],["send-message",this.onChangeMessages],["edited",this.setStatusEdited],["deleted",this.deleteMessage]]),this.emitterMap.forEach((s,a)=>{this.unsubscribes.push(o.on(a,s))})}createView(){const e=new n({tag:"div",classNames:["dialog-user"]});e.append(this.dialogUserLogin,this.dialogUserStatus),this.messagesBox.append(this.placeholder,this.messages),this.append(e,this.messagesBox)}addMessage(e){console.log("msg=author",e);const s=new H(e);this.messages.append(s),this.messagesMap.set(e.id,s),e.author&&s.on("contextmenu",a=>{a.preventDefault(),this.createContextMenu(e.id,e.text,s)})}scrollMessages(e){this.isProgrammScroll=!0;const s=this.messages.element,a=this.divider.element;if(this.isDivider){const r=s.getBoundingClientRect(),c=a.getBoundingClientRect();c.top>=r.top&&s.scrollTo({top:s.scrollTop+(c.top-r.top)-10,behavior:e?"smooth":"auto"})}else s.scrollHeight>s.clientHeight&&s.scrollTo({top:s.scrollHeight-s.clientHeight,behavior:e?"smooth":"auto"})}}class F extends n{constructor(e){super(e);i(this,"isEdit",!1);i(this,"prevText","");i(this,"messageForm",new n({tag:"form",classNames:["message-form"]}));i(this,"messageInput",new n({tag:"input",classNames:["message-input"]}));i(this,"sendBtn",new m({type:"submit",classNames:["send-btn"],text:"Send"}));i(this,"undoEditBtn",new n({tag:"div",classNames:["undo-edit-btn","hidden"]}));i(this,"enableInput",()=>{this.messageInput.getElement().disabled=!1});i(this,"onInputMessage",()=>{const{value:e}=this.messageInput.getElement();e.trim()===""?this.sendBtn.disable():this.sendBtn.enable()});i(this,"onSubmitForm",e=>{e.preventDefault();const s=this.messageInput.getElement().value;this.isEdit?s.trim()!==this.prevText&&(o.emit("edit-message",s),this.isEdit=!1):o.emit("send-message",s),this.messageInput.getElement().value="",this.sendBtn.disable(),this.undoEditBtn.addClass("hidden")});i(this,"changeMessage",e=>{if(typeof e!="string")throw new Error("text is not string");this.isEdit=!0,this.prevText=e,this.sendBtn.enable(),this.undoEditBtn.removeClass("hidden"),this.messageInput.getElement().value=e});i(this,"resetForm",()=>{this.isEdit=!1,this.undoEditBtn.addClass("hidden"),this.messageInput.getElement().value="",this.sendBtn.disable()});this.createView(),o.on("set-dialog-user",this.enableInput),o.on("change-message",this.changeMessage),o.on("reset-new-message",this.resetForm),this.messageInput.on("input",this.onInputMessage),this.messageForm.on("submit",this.onSubmitForm),this.undoEditBtn.on("click",this.resetForm)}createView(){const e=new n({tag:"div",classNames:["input-box"]});e.append(this.messageInput,this.undoEditBtn),this.messageForm.append(e,this.sendBtn),this.append(this.messageForm),this.messageInput.attr("type","text"),this.messageInput.attr("placeholder","Write a message..."),this.messageInput.getElement().disabled=!0,this.sendBtn.disable()}}class J extends n{constructor(){super({tag:"div",classNames:["main-wrapper"]}),this.createView()}createView(){const t=new P({tag:"header",classNames:["header"]}),e=new G({tag:"footer",classNames:["footer"]}),s=new n({tag:"main",classNames:["main"]}),a=new O({tag:"div",classNames:["users-wrapper"]}),r=new n({tag:"div",classNames:["messages-wrapper"]}),c=new A({tag:"div",classNames:["dialog-wrapper"]}),u=new F({tag:"div",classNames:["new-message-wrapper"]});r.append(c,u),s.append(a,r),this.append(t,s,e)}}class $ extends n{constructor(){super({tag:"div",classNames:["about-wrapper"]});i(this,"backBtn",new n({tag:"a",classNames:["back-btn"],text:"Back"}));this.createView(),this.backBtn.on("click",()=>o.emit("navigate","back"))}createView(){const e=new n({tag:"h2",classNames:["about-title"],text:"Fun Chat"}),s=new n({tag:"p",classNames:["about-text"]});s.setTextContent("This application was developed as part of the RSSchool course in 2023Q3. The goal of the project was to create a web application for communication and message exchange between users");const a=new n({tag:"a",classNames:["about-author"],text:"Olga Yakusheva"});a.attr("href","https://gryzun33.github.io/rsschool-cv/"),a.attr("target","_blank"),this.append(e,s,a,this.backBtn)}}class K extends y{constructor(t){super(t),this.createView()}createView(){super.createView();const t=new n({tag:"div",classNames:["loader"]});this.modalContent.append(this.modalText,t)}}class W{constructor(){i(this,"page","");i(this,"root",new n({tag:"div",classNames:["wrapper"]}));i(this,"router");i(this,"currPage");i(this,"modal");i(this,"controller",new I);i(this,"openModal",()=>{this.modal=new K("Connecting to the server"),this.root.append(this.modal)});i(this,"closeModal",()=>{var t;(t=this.modal)==null||t.close()});const t=this.createRoutes();this.router=new C(t),o.on("disconnect",this.openModal),o.on("connect",this.closeModal)}start(){document.body.append(this.root.element),this.router.init()}createRoutes(){return[{path:"login",callback:()=>this.setContent(new L,"login")},{path:"main",callback:()=>this.setContent(new J,"main")},{path:"about",callback:()=>this.setContent(new $,"about")}]}setContent(t,e){this.currPage&&this.currPage.destroy(),this.currPage=t,this.root.append(t),this.page==="about"&&e==="main"&&this.controller.externalUsersRequest(),this.page=e}}const Q=new W;Q.start();
//# sourceMappingURL=index-BunzS2Rf.js.map
